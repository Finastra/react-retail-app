{"version":3,"file":"main.js","mappings":"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","sources":["webpack://react-retail-app/./apps/api/src/app/app.module.ts","webpack://react-retail-app/./apps/api/src/app/health/health.controller.ts","webpack://react-retail-app/./apps/api/src/app/health/health.module.ts","webpack://react-retail-app/./apps/api/src/app/setup-static.ts","webpack://react-retail-app/./apps/api/src/configs/oidc-config.service.ts","webpack://react-retail-app/./apps/api/src/configs/proxy-config.service.ts","webpack://react-retail-app/./apps/api/src/configs/serve-static-config.service.ts","webpack://react-retail-app/external commonjs \"@finastra/nestjs-logger\"","webpack://react-retail-app/external commonjs \"@finastra/nestjs-oidc\"","webpack://react-retail-app/external commonjs \"@finastra/nestjs-proxy\"","webpack://react-retail-app/external commonjs \"@nestjs/common\"","webpack://react-retail-app/external commonjs \"@nestjs/config\"","webpack://react-retail-app/external commonjs \"@nestjs/core\"","webpack://react-retail-app/external commonjs \"@nestjs/serve-static\"","webpack://react-retail-app/external commonjs \"@nestjs/terminus\"","webpack://react-retail-app/external commonjs \"compression\"","webpack://react-retail-app/external commonjs \"tslib\"","webpack://react-retail-app/external node-commonjs \"path\"","webpack://react-retail-app/webpack/bootstrap","webpack://react-retail-app/./apps/api/src/main.ts"],"sourcesContent":["import { LoggerModule } from '@finastra/nestjs-logger';\r\nimport { ProxyModule } from '@finastra/nestjs-proxy';\r\nimport { MiddlewareConsumer, Module, RequestMethod } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\nimport { OidcModule } from '@finastra/nestjs-oidc';\r\nimport { ServeStaticModule } from '@nestjs/serve-static';\r\nimport { OidcConfigService } from '../configs/oidc-config.service';\r\nimport { ProxyConfigService } from '../configs/proxy-config.service';\r\nimport { appFolder, ServeStaticConfigService } from '../configs/serve-static-config.service';\r\nimport { HealthModule } from './health/health.module';\r\nimport { StaticMiddleware } from './setup-static';\r\n\r\n@Module({\r\n  imports: [\r\n    OidcModule.forRootAsync({\r\n      imports: [ConfigModule],\r\n      useClass: OidcConfigService,\r\n    }), \r\n    ConfigModule.forRoot({\r\n      isGlobal: true,\r\n      ignoreEnvFile: process.env.NODE_ENV === 'production',\r\n    }),\r\n   ServeStaticModule.forRootAsync({\r\n      useClass: ServeStaticConfigService,\r\n    }),\r\n    ServeStaticModule.forRoot({\r\n      serveRoot: '/static',\r\n      rootPath: appFolder,\r\n    }),\r\n    ProxyModule.forRootAsync({\r\n      useClass: ProxyConfigService,\r\n      imports: [ConfigModule],\r\n    }),\r\n    HealthModule,\r\n    LoggerModule,\r\n  ],\r\n})\r\nexport class AppModule {\r\n  configure(consumer: MiddlewareConsumer) {\r\n\r\n    consumer\r\n\r\n      .apply(StaticMiddleware)\r\n      .exclude(\r\n        { path: '/health', method: RequestMethod.ALL },\r\n        { path: '/login/callback', method: RequestMethod.ALL },\r\n        { path: '/login', method: RequestMethod.ALL }\r\n\r\n      )\r\n\r\n      .forRoutes({\r\n        path: '/',\r\n        method: RequestMethod.ALL,\r\n      });\r\n\r\n  }\r\n}","import { Public } from '@finastra/nestjs-oidc';\r\nimport { Controller, Get } from '@nestjs/common';\r\nimport { HealthCheck } from '@nestjs/terminus';\r\n\r\n@Controller('health')\r\nexport class HealthController {\r\n  constructor() { }\r\n  //constructor(private health: HealthCheckService, private mongoose: MongooseHealthIndicator) {}\r\n\r\n  @Get()\r\n  @Public()\r\n  @HealthCheck()\r\n  healthCheck() {\r\n    return true;\r\n    //return this.health.check([async () => this.mongoose.pingCheck('mongoose')]);\r\n  }\r\n}","import { Module } from '@nestjs/common';\r\nimport { TerminusModule } from '@nestjs/terminus';\r\nimport { HealthController } from './health.controller';\r\n\r\n@Module({\r\n  imports: [TerminusModule],\r\n  controllers: [HealthController],\r\n})\r\nexport class HealthModule {}","import { LOGIN_SESSION_COOKIE } from '@finastra/nestjs-oidc';\r\nimport { Injectable, NestMiddleware } from '@nestjs/common';\r\nimport { Response } from 'express';\r\n\r\n@Injectable()\r\nexport class StaticMiddleware implements NestMiddleware {\r\n  use(req: any, res: Response, next: Function) {\r\n\r\n    if (req.isAuthenticated()) {\r\n      return next();\r\n    }\r\n\r\n     /* res.cookie(LOGIN_SESSION_COOKIE, 'logging in', {\r\n\r\n      maxAge: 15 * 1000 * 60,\r\n\r\n    }); */\r\n\r\n    res.redirect(`/login`);\r\n\r\n  }\r\n\r\n}","import { OidcModuleOptions, OidcOptionsFactory, UserInfoMethod } from '@finastra/nestjs-oidc';\r\nimport { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\n\r\n@Injectable()\r\nexport class OidcConfigService implements OidcOptionsFactory {\r\n  readonly logger = new Logger(OidcConfigService.name);\r\n\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  createModuleConfig(): OidcModuleOptions {\r\n    const issuer = this.configService.get('OIDC_ISSUER');\r\n    const client_id = this.configService.get('OIDC_CLIENT_ID');\r\n    const origin = this.configService.get('OIDC_ORIGIN');\r\n\r\n    this.logger.log(`\r\nissuer        : ${issuer}\r\nclient_id     : ${client_id}\r\norigin        : ${origin}`);\r\n\r\n    return {\r\n      issuer: this.configService.get('OIDC_ISSUER'),\r\n      clientMetadata: {\r\n        client_id: this.configService.get('OIDC_CLIENT_ID'),\r\n        client_secret: this.configService.get('OIDC_CLIENT_SECRET'),\r\n      },\r\n      authParams: {\r\n        scope: this.configService.get('OIDC_SCOPE'),\r\n        resource: this.configService.get('OIDC_RESOURCE'),\r\n        nonce: 'true',\r\n      },\r\n      origin,\r\n      userInfoMethod: UserInfoMethod.token,\r\n      defaultHttpOptions: {\r\n        timeout: 20000,\r\n      }\r\n    };\r\n  }\r\n}","import { ProxyModuleOptions, ProxyModuleOptionsFactory } from '@finastra/nestjs-proxy';\r\nimport { Injectable, Logger } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\n\r\n// Documentation for the proxy module can be founde here:\r\n// https://github.com/Finastra/finastra-nodejs-libs/blob/develop/libs/proxy/README.md\r\n\r\n@Injectable()\r\nexport class ProxyConfigService implements ProxyModuleOptionsFactory {\r\n  readonly logger = new Logger(ProxyConfigService.name);\r\n\r\n  constructor(private configService: ConfigService) {}\r\n\r\n  createModuleConfig(): ProxyModuleOptions {\r\n    const FFDC = this.configService.get('FFDC');\r\n\r\n    const services = [\r\n      {\r\n        id: 'ACCOUNT_INFORMATION_US',\r\n        url: `${FFDC}/retail-us/me/account/v1`,\r\n        config: {}\r\n      },\r\n      {\r\n        id: 'CONSUMER_PROFILE',\r\n        url: `${FFDC}/retail-us/me/v1`,\r\n        config: {}\r\n      },\r\n      {\r\n        id: 'PERSON_TO_PERSON',\r\n        url: `${FFDC}/retail-us/me/p2p/v1`,\r\n        config: {}\r\n      }\r\n    ];\r\n\r\n    this.logger.log(services);\r\n\r\n    return {\r\n      services,\r\n      allowedCookies: [],\r\n    };\r\n  }\r\n}","import { Injectable } from '@nestjs/common';\r\nimport {\r\n    ServeStaticModuleOptions, ServeStaticModuleOptionsFactory\r\n} from '@nestjs/serve-static';\r\nimport { join } from 'path';\r\n\r\nexport const appFolder = join(__dirname, '../../..', 'dist/apps/retail-app');\r\n\r\n@Injectable()\r\nexport class ServeStaticConfigService implements ServeStaticModuleOptionsFactory {\r\n  constructor() {}\r\n\r\n  createLoggerOptions(): ServeStaticModuleOptions[] {\r\n    return [\r\n      {\r\n        rootPath: appFolder,\r\n      },\r\n    ];\r\n  }\r\n}","module.exports = require(\"@finastra/nestjs-logger\");","module.exports = require(\"@finastra/nestjs-oidc\");","module.exports = require(\"@finastra/nestjs-proxy\");","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/config\");","module.exports = require(\"@nestjs/core\");","module.exports = require(\"@nestjs/serve-static\");","module.exports = require(\"@nestjs/terminus\");","module.exports = require(\"compression\");","module.exports = require(\"tslib\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { HttpLoggingInterceptor, OMSLogger } from '@finastra/nestjs-logger';\r\nimport { setupSession, TokenGuard } from '@finastra/nestjs-oidc';\r\nimport { Logger } from '@nestjs/common';\r\nimport { NestFactory } from '@nestjs/core';\r\nimport * as compression from 'compression';\r\nimport { AppModule } from './app/app.module';\r\n\r\nasync function bootstrap() {\r\n  const omsLogger = new OMSLogger();\r\n  const app = await NestFactory.create(AppModule, {\r\n    logger: omsLogger,\r\n  });\r\n  app.useLogger(omsLogger);\r\n  app.useGlobalInterceptors(new HttpLoggingInterceptor());\r\n\r\n  app.use(compression());\r\n\r\n  app.useGlobalGuards(app.get(TokenGuard));\r\n\r\n  setupSession(app, 'react-retail-app'); \r\n\r\n\r\n  const port = process.env.PORT || 3000;\r\n\r\n  await app.listen(port, () => {\r\n    Logger.log('Listening at http://localhost:' + port, 'main');\r\n  });\r\n}\r\n\r\nbootstrap();"],"names":[],"sourceRoot":""}